<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - Mobicomm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #000000;
            --secondary: #FFD700;
            --bg: #1a3c34;
            --text: #E0E0E0;
            --accent-success: #00E676;
            --accent-urgent: #FF4081;
            --highlight: #a20b4f;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .navbar {
            background: #a20b4f !important;
            border-bottom: 3px solid var(--secondary);
        }

        .navbar-brand,
        .nav-link {
            color: #fff !important;
        }

        .nav-link.active {
            font-weight: bold;
            text-decoration: underline;
        }

        .nav-link:hover {
            color: var(--accent-urgent) !important;
            font-weight: bold;
            border-radius: 3px;
            background-color: var(--secondary);
            padding: 5px;
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(255, 215, 0, 0.2);
        }

        .card {
            background-color: #1E1E1E;
            border: 2px solid #2E2E2E;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.1);
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--secondary);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--accent-urgent), #FF6B9E);
            border: none;
            border-radius: 50px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 64, 129, 0.4);
        }

        h4,
        h5 {
            color: var(--secondary);
        }

        .table {
            background-color: #1E1E1E;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--secondary);
        }

        .table thead {
            background-color: var(--highlight);
            color: var(--secondary);
            border-bottom: 2px solid var(--secondary);
        }

        .table tbody tr {
            border-bottom: 1px solid #2E2E2E;
        }

        .table tbody tr:hover {
            background-color: #2E2E2E;
        }

        .text-success {
            color: var(--accent-success) !important;
            font-weight: bold;
        }

        /* Enhanced Footer */
        footer {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            color: var(--text);
            padding: 3rem 0 1rem;
            border-top: 3px solid var(--secondary);
            position: fixed;
            bottom: 0;
            width: 100%;
            margin: auto;
            z-index: 1000;
        }

        .navbar-toggler {
            border-color: var(--secondary);
        }

        .navbar-toggler-icon {
            filter: invert(1);
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Welcome, John</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="#">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="recharge.html">Recharge</a></li>
                    <li class="nav-item"><a class="nav-link" href="history.html">History</a></li>
                    <li class="nav-item"><a class="nav-link" href="auto-recharge.html">Auto-Recharge</a></li>
                    <li class="nav-item"><a class="nav-link" href="support.html">Support</a></li>
                    <li class="nav-item"><a class="nav-link" href="login.html">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row g-4">
            <div class="col-md-3">
                <div class="card p-3 text-center">
                    <h5>Recharge Now</h5><a href="recharge.html" class="btn btn-primary">Go</a>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card p-3 text-center">
                    <h5>Transaction History</h5><a href="history.html" class="btn btn-primary">Go</a>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card p-3 text-center">
                    <h5>Auto-Recharge</h5><a href="auto-recharge.html" class="btn btn-primary">Go</a>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card p-3 text-center">
                    <h5>Contact Support</h5><a href="support.html" class="btn btn-primary">Go</a>
                </div>
            </div>
        </div>

        <div class="mt-5">
            <h4>Recent Transactions</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Plan</th>
                        <th>Amount</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2025-03-01</td>
                        <td>1GB Daily</td>
                        <td>₹199</td>
                        <td class="text-success">Success</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <footer class="text-center py-3 mt-5">
        <p class="text-center">© <span id="year"></span> Mobi Comm. All rights reserved. | <a href="#">Privacy
                Policy</a> | <a href="#">Terms of Service</a></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        // Set current year in footer
        document.getElementById('year').textContent = new Date().getFullYear();

        // Add payment modal
        const modalHTML = `
            <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content" style="background-color: #1E1E1E; color: var(--text);">
                        <div class="modal-header" style="border-bottom: 2px solid var(--secondary);">
                            <h5 class="modal-title" id="paymentModalLabel">Complete Your Recharge</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-4">
                                <h6>Selected Plan: <span class="text-secondary" id="selectedPlanName">1GB Daily - ₹199</span></h6>
                                <p class="mb-0">Mobile Number: <input type="tel" id="mobileNumber" class="form-control" value="9876543210" style="background-color: #2E2E2E; color: var(--text); border: 1px solid var(--secondary);"></p>
                                <p class="mb-0">Plan Type: <span id="selectedPlanType">Prepaid</span></p>
                                <p class="mb-0">Expiry: <span id="planExpiry"></span></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Select Payment Method</label>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-secondary text-start" style="border-color: var(--secondary); color: var(--text);">
                                        <i class="fas fa-credit-card me-2"></i> Credit/Debit Card
                                    </button>
                                    <button class="btn btn-outline-secondary text-start" style="border-color: var(--secondary); color: var(--text);">
                                        <i class="fas fa-wallet me-2"></i> UPI Payment
                                    </button>
                                    <button class="btn btn-outline-secondary text-start" style="border-color: var(--secondary); color: var(--text);">
                                        <i class="fas fa-mobile-alt me-2"></i> Wallet
                                    </button>
                                </div>
                            </div>
                            <div class="payment-notification" id="paymentNotification" style="display: none; margin-top: 15px; padding: 10px; background-color: rgba(0, 230, 118, 0.1); border: 1px solid var(--accent-success); border-radius: 8px; color: var(--accent-success); text-align: center;">
                                <i class="fas fa-check-circle me-2"></i> Payment confirmation has been sent to your registered email ID: customer@example.com
                            </div>
                        </div>
                        <div class="modal-footer" style="border-top: 2px solid var(--secondary);">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-color: var(--secondary); color: var(--text);">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="processPayment()">Confirm Payment</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);

        // Trigger recharge modal from "Recharge Now" button
        document.querySelector('a[href="recharge.html"]').addEventListener('click', function(e) {
            e.preventDefault();
            const modal = new bootstrap.Modal(document.getElementById('paymentModal'));
            modal.show();
        });

        // Payment processing with validation
        function processPayment() {
            const mobileNumber = document.getElementById('mobileNumber').value;
            const planName = document.getElementById('selectedPlanName').textContent;
            const planType = document.getElementById('selectedPlanType').textContent;
            const priceMatch = planName.match(/₹(\d+)/);
            const price = priceMatch ? parseInt(priceMatch[1]) * 100 : 19900; // Default to ₹199
            const validityMatch = planName.match(/(\d+)\s*Days/);
            const validityDays = validityMatch ? parseInt(validityMatch[1]) : 30; // Default to 30 days
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + validityDays);
            document.getElementById('planExpiry').textContent = expiryDate.toLocaleDateString();

            // Validate MobiComm number
            if (!mobileNumber.startsWith('987') || mobileNumber.length !== 10) {
                alert('Recharge is allowed only for MobiComm numbers (starting with 987).');
                return;
            }

            // Check for existing recharge
            const rechargeHistory = JSON.parse(localStorage.getItem(`recharge_${mobileNumber}`)) || [];
            const currentDate = new Date().toISOString().split('T')[0];
            const existingRecharge = rechargeHistory.find(r => {
                const expiry = new Date(r.expiry);
                return expiry > new Date();
            });

            if (existingRecharge) {
                if (confirm(`You have an active plan (${existingRecharge.plan}) expiring on ${new Date(existingRecharge.expiry).toLocaleDateString()}. If you recharge now, it will apply after the current plan expires. Proceed?`)) {
                    rechargeHistory.push({
                        plan: planName,
                        expiry: expiryDate.toISOString(),
                        date: currentDate,
                        applied: false
                    });
                    localStorage.setItem(`recharge_${mobileNumber}`, JSON.stringify(rechargeHistory));
                    alert(`Recharge queued for ${mobileNumber}. It will apply after your current plan expires on ${new Date(existingRecharge.expiry).toLocaleDateString()}.`);
                } else {
                    return;
                }
            } else {
                // Proceed with payment
                rechargeHistory.push({
                    plan: planName,
                    expiry: expiryDate.toISOString(),
                    date: currentDate,
                    applied: true
                });
                localStorage.setItem(`recharge_${mobileNumber}`, JSON.stringify(rechargeHistory));

                const options = {
                    key: 'rzp_test_DD9GRYAdLgtztF',
                    amount: price,
                    currency: 'INR',
                    name: 'MobiComm',
                    description: `${planType} ${planName}`,
                    handler: function(response) {
                        const notification = document.getElementById('paymentNotification');
                        notification.style.display = 'block';
                        alert(`Payment successful for ${mobileNumber}!\nPlan: ${planName}\nPayment ID: ${response.razorpay_payment_id}`);
                        setTimeout(() => {
                            const modal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
                            modal.hide();
                        }, 3000);
                    },
                    theme: {
                        color: '#a20b4f'
                    }
                };
                const rzp = new Razorpay(options);
                rzp.open();
            }
        }

        // Update recent transactions table dynamically (simulation)
        function updateTransactionHistory(mobileNumber, planName, amount, date) {
            const tbody = document.querySelector('tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${date}</td>
                <td>${planName}</td>
                <td>${amount}</td>
                <td class="text-success">Success</td>
            `;
            tbody.prepend(row);
        }

        // Call update after payment success (in real app, this would be backend-driven)
        document.getElementById('paymentModal').addEventListener('hidden.bs.modal', function () {
            const notification = document.getElementById('paymentNotification');
            if (notification.style.display === 'block') {
                const mobileNumber = document.getElementById('mobileNumber').value;
                const planName = document.getElementById('selectedPlanName').textContent;
                const amountMatch = planName.match(/₹(\d+)/);
                const amount = amountMatch ? `₹${amountMatch[1]}` : '₹199';
                const date = new Date().toISOString().split('T')[0];
                updateTransactionHistory(mobileNumber, planName, amount, date);
                notification.style.display = 'none'; // Hide notification after modal closes
            }
        });
    </script>
</body>

</html>